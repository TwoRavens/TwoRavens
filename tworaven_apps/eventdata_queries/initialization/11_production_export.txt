# for performance, add some indices to ICEWS locally
mongo
use event_data
db.icews.createIndex({"Source Name": 1, "Target Name": 1, "CAMEO Code": 1, "TwoRavens_Event Date": 1}, {"name": "Actor"})
db.icews.createIndex({"Target Name": 1})
db.icews.createIndex({"Source Country": 1, "Source Name": 1})
db.icews.createIndex({"Target Country": 1, "Target Name": 1})
db.icews.createIndex({"Source Sectors Grouped": 1})
db.icews.createIndex({"Target Sectors Grouped": 1})

db.cline_phoenix_swb.createIndex({"source": 1, "target": 1})
db.cline_phoenix_swb.createIndex({"target": 1})

# for each collection, export to an archive
mongodump -d event_data -c [COLLECTION] --archive=./dbs/[COLLECTION] --gzip

# upload to digitalocean
scp ./dbs/* eventuser@178.128.144.175:dbs/

# log into digitalocean
ssh eventuser@178.128.144.175

# log into mongo
mongo admin -u AdminEvent -p --authenticationDatabase admin
use event_data

# drop each collection that will be restored
db.[COLLECTION].drop()

# move to database folder
quit()
cd dbs/

# restore databases
mongorestore -u AdminEvent -p [PASSWORD] -d event_data --archive=[COLLECTION] --authenticationDatabase admin --gzip

# don't forget to upload the tsv files for direct download
scp ./tworaven_apps/eventdata_queries/initialization/temp/* eventuser@178.128.144.175:EventData/
