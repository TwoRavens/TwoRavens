language: python

python:
  - "3.6"

services:
  - docker

install:
  # Build/test dependencies
  - pip install --no-cache-dir -r requirements/prod.txt

script:
  # Run django tests.  (Note django settings are an env variable)
  - python manage.py test
  # If tests passed, build docker image--and see if that works
  - docker build -t tworavens/ravens-main:latest .

# Don't push the image but instead trigger a build on dockerhub
after_script: >-
  curl -H "Content-Type: application/json" 
  --data '{"docker_tag": "master"}' 
  -X POST https://registry.hub.docker.com/u/tworavens/ravens-main/trigger/9269f094-1951-4d52-ba6d-15b216cec4a4/

  #- if [ "$TRAVIS_BRANCH" == "master" ]; then
  #  curl -H "Content-Type: application/json" --data '{"build": true}' -X POST https://registry.hub.docker.com/u/tworavens/ravens-main/trigger/9269f094-1951-4d52-ba6d-15b216cec4a4/;
  #  fi
  # Push image to dockerhub
  #- if [ "$TRAVIS_BRANCH" == "master" ]; then
  #  docker login -u="$DOCKER_USERNAME" -p="$DOCKER_PASSWORD";
  #  docker push tworavens/ravens-main;
  #  fi
#  - docker login -u="$DOCKER_USERNAME" -p="$DOCKER_PASSWORD"
#  - docker push tworavens/ravens-main:latest
